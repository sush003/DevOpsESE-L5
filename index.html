<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IoT Sensor Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3rem;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-healthy {
        background-color: #4caf50;
      }
      .status-warning {
        background-color: #ff9800;
      }
      .status-error {
        background-color: #f44336;
      }

      .metric {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }

      .metric:last-child {
        border-bottom: none;
      }

      .metric-value {
        font-weight: bold;
        color: #667eea;
      }

      .sensor-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .sensor-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
      }

      .sensor-id {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .sensor-data {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        font-size: 0.9rem;
        color: #666;
      }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }

      .btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease;
      }

      .btn:hover {
        background: #5a6fd8;
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .btn-danger {
        background: #f44336;
      }

      .btn-danger:hover {
        background: #d32f2f;
      }

      .load-test-controls {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background: #eee;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        width: 0%;
        transition: width 0.3s ease;
      }

      .log {
        background: #1e1e1e;
        color: #00ff00;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        max-height: 200px;
        overflow-y: auto;
        margin-top: 15px;
      }

      @media (max-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üå°Ô∏è IoT Sensor Dashboard</h1>
        <p>Real-time monitoring and auto-scaling demonstration</p>
      </div>

      <div class="dashboard">
        <div class="card">
          <h3>üìä System Status</h3>
          <div class="metric">
            <span>API Health</span>
            <span id="api-status">
              <span class="status-indicator status-healthy"></span>
              <span class="metric-value">Checking...</span>
            </span>
          </div>
          <div class="metric">
            <span>Total Sensors</span>
            <span class="metric-value" id="sensor-count">0</span>
          </div>
          <div class="metric">
            <span>Last Update</span>
            <span class="metric-value" id="last-update">Never</span>
          </div>
          <div class="metric">
            <span>Auto Refresh</span>
            <span class="metric-value">
              <input type="checkbox" id="auto-refresh" checked /> Enabled
            </span>
          </div>
        </div>

        <div class="card">
          <h3>üî• Load Testing</h3>
          <div class="controls">
            <button class="btn" onclick="startLightLoad()">Light Load</button>
            <button class="btn" onclick="startMediumLoad()">Medium Load</button>
            <button class="btn btn-danger" onclick="startHeavyLoad()">
              Heavy Load
            </button>
            <button class="btn" onclick="stopLoad()">Stop Load</button>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="load-progress"></div>
          </div>
          <div id="load-status">Ready to generate load</div>
        </div>

        <div class="card">
          <h3>‚ûï Add Sensor Data</h3>
          <div style="display: grid; gap: 10px">
            <input
              type="text"
              id="sensor-id"
              placeholder="Sensor ID (optional)"
              style="padding: 8px; border: 1px solid #ddd; border-radius: 4px"
            />
            <input
              type="number"
              id="temperature"
              placeholder="Temperature (¬∞C)"
              style="padding: 8px; border: 1px solid #ddd; border-radius: 4px"
            />
            <input
              type="number"
              id="humidity"
              placeholder="Humidity (%)"
              style="padding: 8px; border: 1px solid #ddd; border-radius: 4px"
            />
            <input
              type="text"
              id="location"
              placeholder="Location"
              style="padding: 8px; border: 1px solid #ddd; border-radius: 4px"
            />
            <button class="btn" onclick="addSensorData()">
              Add Sensor Reading
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>üì° Sensor Readings</h3>
        <div class="controls">
          <button class="btn" onclick="refreshSensors()">Refresh Data</button>
          <button class="btn" onclick="clearSensors()">Clear All</button>
          <button class="btn" onclick="generateRandomData()">
            Generate Random Data
          </button>
        </div>
        <div class="sensor-list" id="sensor-list">
          <p style="text-align: center; color: #666; padding: 20px">
            No sensor data available. Add some readings above!
          </p>
        </div>
      </div>

      <div class="log" id="activity-log">
        <div>IoT Sensor Dashboard initialized...</div>
        <div>Connecting to API...</div>
      </div>
    </div>

    <script>
      const API_BASE = window.location.origin;
      let loadTestInterval = null;
      let refreshInterval = null;

      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", function () {
        checkApiHealth();
        refreshSensors();
        startAutoRefresh();
        log("Dashboard ready!");
      });

      // Logging function
      function log(message) {
        const logElement = document.getElementById("activity-log");
        const timestamp = new Date().toLocaleTimeString();
        logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      // Check API health
      async function checkApiHealth() {
        try {
          const response = await fetch(`${API_BASE}/health`);
          const data = await response.json();

          document.getElementById("api-status").innerHTML = `
                    <span class="status-indicator status-healthy"></span>
                    <span class="metric-value">Healthy</span>
                `;
          document.getElementById("last-update").textContent = new Date(
            data.timestamp
          ).toLocaleTimeString();
          log("API health check: OK");
        } catch (error) {
          document.getElementById("api-status").innerHTML = `
                    <span class="status-indicator status-error"></span>
                    <span class="metric-value">Error</span>
                `;
          log("API health check: FAILED - " + error.message);
        }
      }

      // Refresh sensor data
      async function refreshSensors() {
        try {
          const response = await fetch(`${API_BASE}/api/sensors`);
          const data = await response.json();

          document.getElementById("sensor-count").textContent = data.count;
          document.getElementById("last-update").textContent = new Date(
            data.timestamp
          ).toLocaleTimeString();

          displaySensors(data.sensors);
          log(`Refreshed sensor data: ${data.count} readings`);
        } catch (error) {
          log("Failed to refresh sensor data: " + error.message);
        }
      }

      // Display sensors
      function displaySensors(sensors) {
        const listElement = document.getElementById("sensor-list");

        if (sensors.length === 0) {
          listElement.innerHTML =
            '<p style="text-align: center; color: #666; padding: 20px;">No sensor data available. Add some readings above!</p>';
          return;
        }

        listElement.innerHTML = sensors
          .map(
            (sensor) => `
                <div class="sensor-item">
                    <div class="sensor-id">${sensor.sensorId}</div>
                    <div class="sensor-data">
                        <div><strong>Temp:</strong> ${
                          sensor.temperature
                        }¬∞C</div>
                        <div><strong>Humidity:</strong> ${
                          sensor.humidity
                        }%</div>
                        <div><strong>Location:</strong> ${sensor.location}</div>
                        <div><strong>Time:</strong> ${new Date(
                          sensor.timestamp
                        ).toLocaleTimeString()}</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Add sensor data
      async function addSensorData() {
        const sensorData = {
          sensorId: document.getElementById("sensor-id").value,
          temperature: parseFloat(document.getElementById("temperature").value),
          humidity: parseFloat(document.getElementById("humidity").value),
          location: document.getElementById("location").value,
        };

        try {
          const response = await fetch(`${API_BASE}/api/sensors`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(sensorData),
          });

          if (response.ok) {
            const result = await response.json();
            log(`Added sensor reading: ${result.sensorId}`);

            // Clear form
            document.getElementById("sensor-id").value = "";
            document.getElementById("temperature").value = "";
            document.getElementById("humidity").value = "";
            document.getElementById("location").value = "";

            refreshSensors();
          } else {
            throw new Error("Failed to add sensor data");
          }
        } catch (error) {
          log("Error adding sensor data: " + error.message);
        }
      }

      // Generate random data
      function generateRandomData() {
        for (let i = 0; i < 5; i++) {
          setTimeout(() => {
            const randomData = {
              sensorId: `sensor-${Math.floor(Math.random() * 1000)}`,
              temperature: Math.floor(Math.random() * 40) + 10,
              humidity: Math.floor(Math.random() * 100),
              location: [
                "Lab-A",
                "Lab-B",
                "Office",
                "Warehouse",
                "Server Room",
              ][Math.floor(Math.random() * 5)],
            };

            fetch(`${API_BASE}/api/sensors`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(randomData),
            });
          }, i * 200);
        }

        setTimeout(refreshSensors, 1500);
        log("Generated 5 random sensor readings");
      }

      // Load testing functions
      function startLightLoad() {
        startLoadTest(5, 60, "Light Load (5 req/s for 60s)");
      }

      function startMediumLoad() {
        startLoadTest(15, 90, "Medium Load (15 req/s for 90s)");
      }

      function startHeavyLoad() {
        startLoadTest(
          30,
          120,
          "Heavy Load (30 req/s for 120s) - Will trigger auto-scaling!"
        );
      }

      function startLoadTest(requestsPerSecond, duration, description) {
        if (loadTestInterval) {
          clearInterval(loadTestInterval);
        }

        log(`Starting ${description}`);
        document.getElementById("load-status").textContent = description;

        let elapsed = 0;
        const progressBar = document.getElementById("load-progress");

        loadTestInterval = setInterval(() => {
          // Make requests
          for (let i = 0; i < requestsPerSecond; i++) {
            fetch(`${API_BASE}/api/load-test?duration=200`).catch(() => {});
            if (i % 3 === 0) {
              fetch(`${API_BASE}/api/sensors`).catch(() => {});
            }
          }

          elapsed++;
          const progress = (elapsed / duration) * 100;
          progressBar.style.width = progress + "%";

          if (elapsed >= duration) {
            stopLoad();
            log(`Load test completed: ${description}`);
          }
        }, 1000);
      }

      function stopLoad() {
        if (loadTestInterval) {
          clearInterval(loadTestInterval);
          loadTestInterval = null;
        }

        document.getElementById("load-progress").style.width = "0%";
        document.getElementById("load-status").textContent =
          "Load test stopped";
        log("Load test stopped");
      }

      // Auto refresh
      function startAutoRefresh() {
        const checkbox = document.getElementById("auto-refresh");

        if (refreshInterval) {
          clearInterval(refreshInterval);
        }

        if (checkbox.checked) {
          refreshInterval = setInterval(() => {
            checkApiHealth();
            refreshSensors();
          }, 5000);
        }
      }

      // Clear sensors
      function clearSensors() {
        // This would require a DELETE endpoint in the API
        log("Clear function would need DELETE API endpoint");
      }

      // Auto refresh toggle
      document
        .getElementById("auto-refresh")
        .addEventListener("change", startAutoRefresh);
    </script>
  </body>
</html>
